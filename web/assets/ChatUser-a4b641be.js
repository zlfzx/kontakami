import{a as i,j as a,u as j,r as c,F as C,b}from"./index-921de7cf.js";import{u as D}from"./user-ca0d8e03.js";function M(r){const t=r.message,m=t.user_id?"items-start":"items-end",o=m=="items-start"?"bg-purple-100":"bg-purple-300",s=t.date?new Date(t.date*1e3):new Date;let d=s.getDate()<10?"0"+s.getDate():s.getDate(),u=s.getMonth()+1<10?"0"+(s.getMonth()+1):s.getMonth()+1,x=s.getFullYear(),f=d+"/"+u+"/"+x,p=s.getHours()<10?"0"+s.getHours():s.getHours(),h=s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes();return f+=" "+p+":"+h,i("div",{className:"w-full py-2 flex flex-col justify-start "+m,children:[i("div",{className:o+" shadow-md px-1 py-1 min-w-min max-w-lg whitespace-pre-wrap",children:[r.replyTo?a("div",{className:"bg-purple-200 shadow-md px-2 py-1 text-gray-600 border-l-2 border-purple-400",children:r.replyTo.text}):"",a("div",{className:"px-2 py-1 text-gray-800",children:r.children})]}),a("span",{className:"text-xs py-1 text-gray-400",children:f})]})}let v;v="/storage/profiles/";function k(){const{chatId:r}=j(),[t,m]=c.useState({}),[o,s]=c.useState([]),[d,u]=c.useState(""),x=async()=>{const l=(await b.get(`/api/v1/chat/${r}`)).data.data;m(l),s(l==null?void 0:l.messages)},f=t!=null&&t.profile_photo?v+t.profile_photo:D,p=c.useRef(null),h=()=>{p.current.scrollTop=p.current.scrollHeight},y=async e=>{e.preventDefault(),d!=""&&await b.post(`/api/v1/chat/${r}`,{text:d}).then(l=>{console.log(l);const g=l.data.data;s(w=>[...w,g]),u("")}).catch(l=>{console.log(l)})},N=e=>{e.keyCode==13&&e.shiftKey==!1&&(e.preventDefault(),y(e))};return c.useEffect(()=>{x(),h(),u("");const e=new WebSocket(`ws://localhost:8080/ws/chat/${r}`);return e.onopen=l=>{console.log("connected chat user")},e.onmessage=l=>{const n=JSON.parse(l.data);window.location.pathname.includes(`/chat/${n.id}`)&&s(w=>[...w,n.message])},()=>{console.log("cleanup chat user"),e.close()}},[r]),c.useEffect(()=>{h()},[o]),i(C,{children:[i("div",{className:"w-full px-4 py-5 border-b sm:px-6 flex flex-row",children:[a("div",{className:"flex flex-col items-center justify-center w-10 h-10 mr-4",children:a("a",{href:"#",className:"relative block",children:a("img",{alt:"profil",src:f,className:"mx-auto object-cover rounded-full h-10 w-10 "})})}),i("div",{className:"flex-1 pl-1 md:mr-16",children:[a("div",{className:"font-medium dark:text-white",children:(t==null?void 0:t.first_name)+" "+(t==null?void 0:t.last_name)}),a("div",{className:"text-sm text-gray-600 dark:text-gray-200",children:t==null?void 0:t.username})]})]}),a("div",{className:"chat h-full px-4 pb-3 overflow-y-auto",ref:p,children:a("div",{className:"flex flex-col justify-start items-center w-full",children:o==null?void 0:o.map((e,l)=>{let n=null;return e.message_id&&(n=o.find(g=>g.id==e.message_id)),a(M,{message:e,replyTo:n,children:e.text},l)})})}),a("div",{className:"w-full bg-gray-100 px-4 py-5",children:i("form",{className:"bg-white shadow rounded flex",onSubmit:y,children:[a("div",{className:"flex-1",children:a("textarea",{name:"",rows:"1",className:"w-full block outline-none py-3 px-4 bg-transparent focus:border-purple-500 resize-none",placeholder:"Type a message...",value:d,onChange:e=>u(e.target.value),onKeyDown:N})}),a("div",{className:"flex-2 flex justify-center",children:a("button",{type:"submit",className:"w-full py-3 px-4 bg-purple-600 hover:bg-purple-700 focus:ring-0 focus:ring-offset-purple-200 text-white transition ease-in duration-200 text-center shadow focus:outline-none",children:"Send"})})]})})]})}export{k as default};
