import{a as d,j as a,u as j,r,F as C,b}from"./index-40d8f17b.js";import{u as D}from"./user-ca0d8e03.js";function M(o){const e=o.message,m=e.user_id?"items-start":"items-end",n=m=="items-start"?"bg-purple-100":"bg-purple-300",t=e.date?new Date(e.date*1e3):new Date;let c=t.getDate()<10?"0"+t.getDate():t.getDate(),i=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,h=t.getFullYear(),f=c+"/"+i+"/"+h,u=t.getHours()<10?"0"+t.getHours():t.getHours(),p=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes();return f+=" "+u+":"+p,d("div",{className:"w-full py-2 flex flex-col justify-start "+m,children:[a("div",{className:n+" shadow-md px-3 py-2 min-w-min max-w-lg whitespace-pre-wrap text-gray-800",children:o.children}),a("span",{className:"text-xs py-1 text-gray-400",children:f})]})}let v;v="/storage/profiles/";function _(){const{chatId:o}=j(),[e,m]=r.useState({}),[n,t]=r.useState([]),[c,i]=r.useState(""),h=async()=>{const l=(await b.get(`/api/v1/chat/${o}`)).data.data;m(l),t(l==null?void 0:l.messages)},f=e!=null&&e.profile_photo?v+e.profile_photo:D,u=r.useRef(null),p=()=>{u.current.scrollTop=u.current.scrollHeight},w=async s=>{s.preventDefault(),c!=""&&await b.post(`/api/v1/chat/${o}`,{text:c}).then(l=>{console.log(l);const y=l.data.data;t(x=>[...x,y]),i("")}).catch(l=>{console.log(l)})},N=s=>{s.keyCode==13&&s.shiftKey==!1&&(s.preventDefault(),w(s))};return r.useEffect(()=>{h(),p(),i("");const s=new WebSocket(`ws://localhost:8080/ws/chat/${o}`);return s.onopen=l=>{console.log("connected chat user")},s.onmessage=l=>{const g=JSON.parse(l.data);window.location.pathname.includes(`/chat/${g.id}`)&&t(x=>[...x,g.message])},()=>{console.log("cleanup chat user"),s.close()}},[o]),r.useEffect(()=>{p()},[n]),d(C,{children:[d("div",{className:"w-full px-4 py-5 border-b sm:px-6 flex flex-row",children:[a("div",{className:"flex flex-col items-center justify-center w-10 h-10 mr-4",children:a("a",{href:"#",className:"relative block",children:a("img",{alt:"profil",src:f,className:"mx-auto object-cover rounded-full h-10 w-10 "})})}),d("div",{className:"flex-1 pl-1 md:mr-16",children:[a("div",{className:"font-medium dark:text-white",children:(e==null?void 0:e.first_name)+" "+(e==null?void 0:e.last_name)}),a("div",{className:"text-sm text-gray-600 dark:text-gray-200",children:e==null?void 0:e.username})]})]}),a("div",{className:"chat h-full px-4 pb-3 overflow-y-auto",ref:u,children:a("div",{className:"flex flex-col justify-start items-center w-full",children:n==null?void 0:n.map((s,l)=>a(M,{message:s,children:s.text},l))})}),a("div",{className:"w-full bg-gray-100 px-4 py-5",children:d("form",{className:"bg-white shadow rounded flex",onSubmit:w,children:[a("div",{className:"flex-1",children:a("textarea",{name:"",rows:"1",className:"w-full block outline-none py-3 px-4 bg-transparent focus:border-purple-500 resize-none",placeholder:"Type a message...",value:c,onChange:s=>i(s.target.value),onKeyDown:N})}),a("div",{className:"flex-2 flex justify-center",children:a("button",{type:"submit",className:"w-full py-3 px-4 bg-purple-600 hover:bg-purple-700 focus:ring-0 focus:ring-offset-purple-200 text-white transition ease-in duration-200 text-center shadow focus:outline-none",children:"Send"})})]})})]})}export{_ as default};
