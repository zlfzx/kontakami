import{a as o,j as e,r as h,C as b,F as v,b as N,u as E}from"./index-d4529158.js";import{u as _}from"./user-ca0d8e03.js";let k;k="/storage/";function M(i){const t=i.message,c=t.user_id?"items-start":"items-end",l=c=="items-start"?"bg-blue-100":"bg-blue-300",s=t.date?new Date(t.date*1e3):new Date;let f=s.getDate()<10?"0"+s.getDate():s.getDate(),g=s.getMonth()+1<10?"0"+(s.getMonth()+1):s.getMonth()+1,p=s.getFullYear(),m=f+"/"+g+"/"+p,x=s.getHours()<10?"0"+s.getHours():s.getHours(),w=s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes();m+=" "+x+":"+w;const a=i.replyTo,r=d=>{const n=d.file;if(n&&n.type=="photo")return e("img",{src:k+"files/photo/"+n.file_name,loading:"lazy",className:"w-full h-full"})};return o("div",{className:"w-full py-2 flex flex-col justify-start "+c,onClick:d=>i.onClickBubble(d,t),children:[o("div",{className:l+" shadow-md min-w-min max-w-lg whitespace-pre-wrap",children:[!!a&&o("div",{className:"bg-blue-200 shadow-md text-gray-600 border-l-2 border-blue-400"+(a.file?" mx-2 mt-2":" mx-1 mt-1"),children:[r(a),!!a.text&&e("div",{className:"px-2 py-1",children:a.text})]}),r(t),!!t.text&&e("div",{className:"px-2 py-1 mx-1 text-gray-800",children:t.text})]}),e("span",{className:"text-xs py-1 text-gray-400",children:m})]})}let T;T="/storage/";function j({chatId:i}){const[t,c]=h.useContext(b),[l,s]=h.useState(""),[f,g]=h.useState(null),[p,m]=h.useState(null),x=async n=>{if(n.preventDefault(),l==""&&!f)return;const u=new FormData;u.append("text",l),t.replyTo&&(data.message_id=t.replyTo.id,u.append("message_id",t.replyTo.id)),f&&u.append("file",f),await N.post(`/api/v1/chat/${i}`,u,{headers:{"Content-Type":"multipart/form-data"}}).then(y=>{console.log(y);const S=y.data.data;c({type:"SET_MESSAGES",payload:[...t.messages,S]}),s(""),c({type:"SET_REPLY_TO",payload:null}),g(null),m(null)}).catch(y=>{console.log(y)})},w=n=>{n.keyCode==13&&n.shiftKey==!1&&(n.preventDefault(),x(n))},a=()=>{c({type:"SET_REPLY_TO",payload:null})};h.useEffect(()=>{s(""),c({type:"SET_REPLY_TO",payload:null})},[i]);const r=n=>{const u=n.target.files[0];u&&(g(u),m(URL.createObjectURL(u)))},d=()=>{g(null),m(null)};return o(v,{children:[!!t.replyTo&&o("div",{className:"text-gray-500 flex items-center justify-between mb-5",children:[e("div",{className:"flex items-center",children:o("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-corner-up-left",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e("path",{d:"M18 18v-6a3 3 0 0 0 -3 -3h-10l4 -4m0 8l-4 -4"})]})}),o("div",{className:"w-full px-4 text-left flex",children:[!!t.replyTo.file&&t.replyTo.file.type=="photo"&&e("div",{className:"mr-3",children:e("img",{src:T+"files/photo/"+t.replyTo.file.file_name,alt:"",className:"w-10",loading:"lazy"})}),e("div",{children:t.replyTo.text})]}),e("div",{className:"flex items-center",children:e("button",{onClick:a,children:o("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-x",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e("path",{d:"M18 6l-12 12"}),e("path",{d:"M6 6l12 12"})]})})})]}),!!p&&o("div",{className:"text-gray-500 flex items-center justify-between mb-3",children:[e("div",{className:"w-full",children:e("img",{src:p,alt:"",className:"w-1/3",loading:"lazy"})}),e("div",{className:"flex items-center",children:e("button",{onClick:d,children:o("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-x",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e("path",{d:"M18 6l-12 12"}),e("path",{d:"M6 6l12 12"})]})})})]}),o("form",{className:"bg-white shadow flex",onSubmit:x,children:[o("div",{className:"flex-1 flex items-center",children:[e("div",{className:"pl-4 text-gray-500 cursor-pointer",children:o("div",{className:"relative inline-block w-full text-center cursor-pointer",children:[e("label",{htmlFor:"file",className:"text-gray-500 cursor-pointer",children:o("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-paperclip inline-block",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e("path",{d:"M15 7l-6.5 6.5a1.5 1.5 0 0 0 3 3l6.5 -6.5a3 3 0 0 0 -6 -6l-6.5 6.5a4.5 4.5 0 0 0 9 9l6.5 -6.5"})]})}),e("input",{id:"file",onChange:r,accept:"image/*",name:"file",type:"file",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"})]})}),e("textarea",{name:"",rows:"1",className:"w-full block outline-none py-3 px-4 bg-transparent border-none  focus:ring-0 resize-none",placeholder:"Type a message...",value:l,onChange:n=>s(n.target.value),onKeyDown:w})]}),e("div",{className:"flex-2 flex justify-center",children:e("button",{type:"submit",className:"w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 focus:ring-0 focus:ring-offset-blue-200 text-white transition ease-in duration-200 text-center shadow focus:outline-none",children:"Send"})})]})]})}let C;C="/storage/profiles/";function B(){var w;const{chatId:i}=E(),[t,c]=h.useContext(b),[l,s]=h.useState({}),f=async()=>{const r=(await N.get(`/api/v1/chat/${i}`)).data.data;s(r),c({type:"SET_MESSAGES",payload:r==null?void 0:r.messages})},g=l!=null&&l.profile_photo?C+l.profile_photo:_,p=h.useRef(null),m=()=>{p.current.scrollTop=p.current.scrollHeight},x=(a,r)=>{a.detail==2&&c({type:"SET_REPLY_TO",payload:r})};return h.useEffect(()=>{f(),m();const a=new WebSocket(`ws://localhost:8080/ws/chat/${i}`);return a.onopen=r=>{console.log("connected chat user")},a.onmessage=r=>{const d=JSON.parse(r.data);window.location.pathname.includes(`/chat/${d.id}`)&&c({type:"SET_MESSAGES",payload:[...t.messages,d.message]})},()=>{console.log("cleanup chat user"),a.close()}},[i]),h.useEffect(()=>{m()},[t.messages]),o(v,{children:[o("div",{className:"w-full px-4 py-5 border-b sm:px-6 flex flex-row",children:[e("div",{className:"flex flex-col items-center justify-center w-10 h-10 mr-4",children:e("a",{href:"#",className:"relative block",children:e("img",{alt:"profil",src:g,className:"mx-auto object-cover rounded-full h-10 w-10 "})})}),o("div",{className:"flex-1 pl-1 md:mr-16",children:[e("div",{className:"font-medium dark:text-white",children:(l==null?void 0:l.first_name)+" "+(l==null?void 0:l.last_name)}),e("div",{className:"text-sm text-gray-600 dark:text-gray-200",children:l==null?void 0:l.username})]})]}),e("div",{className:"chat h-full px-4 pb-3 overflow-y-auto",ref:p,children:e("div",{className:"flex flex-col justify-start items-center w-full",children:(w=t.messages)==null?void 0:w.map((a,r)=>{let d=null;return a.message_id&&(d=t.messages.find(n=>n.id==a.message_id)),e(M,{message:a,replyTo:d,onClickBubble:n=>x(n,a)},r)})})}),e("div",{className:"w-full bg-gray-100 px-4 py-5",children:e(j,{chatId:i})})]})}export{B as default};
