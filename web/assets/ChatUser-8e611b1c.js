import{r as i,C as b,a as s,j as e,F as N,b as k,u as _}from"./index-a7b12a03.js";import{u as M}from"./user-ca0d8e03.js";let T;T="/storage/";function j(c){const[a,m]=i.useContext(b),t=c.message,u=t.user_id?"items-start":"items-end",x=u=="items-start"?"bg-blue-100":"bg-blue-300",l=t.date?new Date(t.date*1e3):new Date;let f=l.getDate()<10?"0"+l.getDate():l.getDate(),g=l.getMonth()+1<10?"0"+(l.getMonth()+1):l.getMonth()+1,w=l.getFullYear(),n=f+"/"+g+"/"+w,o=l.getHours()<10?"0"+l.getHours():l.getHours(),p=l.getMinutes()<10?"0"+l.getMinutes():l.getMinutes();n+=" "+o+":"+p;const d=c.replyTo,r=y=>{const v=y.file;if(v&&v.type=="photo")return e("img",{src:T+"files/photo/"+v.file_name,loading:"lazy",className:"w-full h-full select-none"})},h=()=>{m({type:"SET_REPLY_TO",payload:t})};return s("div",{className:"w-full py-2 flex flex-col justify-start "+u,onDoubleClick:h,children:[s("div",{className:x+" shadow-md min-w-min max-w-lg whitespace-pre-wrap",children:[!!d&&s("div",{className:"bg-blue-200 shadow-md text-gray-600 border-l-2 border-blue-400"+(d.file?" mx-2 mt-2":" mx-1 mt-1"),children:[r(d),!!d.text&&e("div",{className:"px-2 py-1",children:d.text})]}),r(t),!!t.text&&e("div",{className:"px-2 py-1 mx-1 text-gray-800",children:t.text})]}),e("span",{className:"text-xs py-1 text-gray-400 select-none",children:n})]})}let S;S="/storage/";function L({chatId:c}){const[a,m]=i.useContext(b),[t,u]=i.useState(""),[x,l]=i.useState(null),[f,g]=i.useState(null),w=async r=>{if(r.preventDefault(),t==""&&!x)return;const h=new FormData;h.append("text",t),a.replyTo&&(data.message_id=a.replyTo.id,h.append("message_id",a.replyTo.id)),x&&h.append("file",x),await k.post(`/api/v1/chat/${c}`,h,{headers:{"Content-Type":"multipart/form-data"}}).then(y=>{console.log(y);const E=y.data.data;m({type:"SET_MESSAGES",payload:[...a.messages,E]}),u(""),m({type:"SET_REPLY_TO",payload:null}),l(null),g(null)}).catch(y=>{console.log(y)})},n=r=>{r.keyCode==13&&r.shiftKey==!1&&(r.preventDefault(),w(r))},o=()=>{m({type:"SET_REPLY_TO",payload:null})};i.useEffect(()=>{u(""),m({type:"SET_REPLY_TO",payload:null})},[c]);const p=r=>{const h=r.target.files[0];h&&(l(h),g(URL.createObjectURL(h)))},d=()=>{l(null),g(null)};return s(N,{children:[!!a.replyTo&&s("div",{className:"text-gray-500 flex items-center justify-between mb-5",children:[e("div",{className:"flex items-center",children:s("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-corner-up-left",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e("path",{d:"M18 18v-6a3 3 0 0 0 -3 -3h-10l4 -4m0 8l-4 -4"})]})}),s("div",{className:"w-full px-4 text-left flex",children:[!!a.replyTo.file&&a.replyTo.file.type=="photo"&&e("div",{className:"mr-3",children:e("img",{src:S+"files/photo/"+a.replyTo.file.file_name,alt:"",className:"w-10",loading:"lazy"})}),e("div",{children:a.replyTo.text})]}),e("div",{className:"flex items-center",children:e("button",{onClick:o,children:s("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-x",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e("path",{d:"M18 6l-12 12"}),e("path",{d:"M6 6l12 12"})]})})})]}),!!f&&s("div",{className:"text-gray-500 flex items-center justify-between mb-3",children:[e("div",{className:"w-full",children:e("img",{src:f,alt:"",className:"w-1/3",loading:"lazy"})}),e("div",{className:"flex items-center",children:e("button",{onClick:d,children:s("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-x",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e("path",{d:"M18 6l-12 12"}),e("path",{d:"M6 6l12 12"})]})})})]}),s("form",{className:"bg-white shadow flex",onSubmit:w,children:[s("div",{className:"flex-1 flex items-center",children:[e("div",{className:"pl-4 text-gray-500 cursor-pointer",children:e("div",{className:"flex w-full items-center justify-center",children:s("label",{className:"flex flex-col items-center cursor-pointer",title:"Upload Image",children:[s("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"#2c3e50",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e("line",{x1:"15",y1:"8",x2:"15.01",y2:"8"}),e("rect",{x:"4",y:"4",width:"16",height:"16",rx:"3"}),e("path",{d:"M4 15l4 -4a3 5 0 0 1 3 0l5 5"}),e("path",{d:"M14 14l1 -1a3 5 0 0 1 3 0l2 2"})]}),e("input",{type:"file",onChange:p,accept:"image/*",className:"hidden"})]})})}),e("textarea",{name:"",rows:"1",className:"w-full block outline-none py-3 px-4 bg-transparent border-none  focus:ring-0 resize-none",placeholder:"Type a message...",value:t,onChange:r=>u(r.target.value),onKeyDown:n})]}),e("div",{className:"flex-2 flex justify-center",children:e("button",{type:"submit",className:"w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 focus:ring-0 focus:ring-offset-blue-200 text-white transition ease-in duration-200 text-center shadow focus:outline-none",children:"Send"})})]})]})}let C;C="/storage/profiles/";function P(){var w;const{chatId:c}=_(),[a,m]=i.useContext(b),[t,u]=i.useState({}),x=async()=>{const o=(await k.get(`/api/v1/chat/${c}`)).data.data;u(o),m({type:"SET_MESSAGES",payload:o==null?void 0:o.messages})},l=t!=null&&t.profile_photo?C+t.profile_photo:M,f=i.useRef(null),g=()=>{f.current.scrollTop=f.current.scrollHeight};return i.useEffect(()=>{x(),g();const n=new WebSocket(`ws://localhost:8080/ws/chat/${c}`);return n.onopen=o=>{console.log("connected chat user")},n.onmessage=o=>{const p=JSON.parse(o.data);window.location.pathname.includes(`/chat/${p.id}`)&&m({type:"SET_MESSAGES",payload:[...a.messages,p.message]})},()=>{console.log("cleanup chat user"),n.close()}},[c]),i.useEffect(()=>{g()},[a.messages]),s(N,{children:[s("div",{className:"w-full px-4 py-5 border-b sm:px-6 flex flex-row",children:[e("div",{className:"flex flex-col items-center justify-center w-10 h-10 mr-4",children:e("a",{href:"#",className:"relative block",children:e("img",{alt:"profil",src:l,className:"mx-auto object-cover rounded-full h-10 w-10 "})})}),s("div",{className:"flex-1 pl-1 md:mr-16",children:[e("div",{className:"font-medium dark:text-white",children:(t==null?void 0:t.first_name)+" "+(t==null?void 0:t.last_name)}),e("div",{className:"text-sm text-gray-600 dark:text-gray-200",children:t==null?void 0:t.username})]})]}),e("div",{className:"chat h-full px-4 pb-3 overflow-y-auto",ref:f,children:e("div",{className:"flex flex-col justify-start items-center w-full",children:(w=a.messages)==null?void 0:w.map((n,o)=>{let p=null;return n.message_id&&(p=a.messages.find(d=>d.id==n.message_id)),e(j,{message:n,replyTo:p},o)})})}),e("div",{className:"w-full bg-gray-100 px-4 py-5",children:e(L,{chatId:c})})]})}export{P as default};
