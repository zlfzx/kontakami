import{a,j as e,u as H,r as c,F as R,b as j}from"./index-b296a06f.js";import{u as P}from"./user-ca0d8e03.js";let S;S="/storage/";function W(d){const l=d.message,b=l.user_id?"items-start":"items-end",h=b=="items-start"?"bg-blue-100":"bg-blue-300",n=l.date?new Date(l.date*1e3):new Date;let f=n.getDate()<10?"0"+n.getDate():n.getDate(),p=n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1,i=n.getFullYear(),u=f+"/"+p+"/"+i,v=n.getHours()<10?"0"+n.getHours():n.getHours(),y=n.getMinutes()<10?"0"+n.getMinutes():n.getMinutes();u+=" "+v+":"+y;const r=d.replyTo,g=m=>{const x=m.file;if(x&&x.type=="photo")return e("img",{src:S+"files/photo/"+x.file_name,loading:"lazy",className:"w-full h-full"})};return a("div",{className:"w-full py-2 flex flex-col justify-start "+b,onClick:m=>d.onClickBubble(m,l),children:[a("div",{className:h+" shadow-md min-w-min max-w-lg whitespace-pre-wrap",children:[!!r&&a("div",{className:"bg-blue-200 shadow-md text-gray-600 border-l-2 border-blue-400"+(r.file?" mx-2 mt-2":" mx-1 mt-1"),children:[g(r),!!r.text&&e("div",{className:"px-2 py-1",children:r.text})]}),g(l),!!l.text&&e("div",{className:"px-2 py-1 mx-1 text-gray-800",children:l.text})]}),e("span",{className:"text-xs py-1 text-gray-400",children:u})]})}let F;F="/storage/profiles/";let L;L="/storage/";function U(){const{chatId:d}=H(),[l,b]=c.useState({}),[h,n]=c.useState([]),[f,p]=c.useState(""),[i,u]=c.useState({}),v=async()=>{const s=(await j.get(`/api/v1/chat/${d}`)).data.data;b(s),n(s==null?void 0:s.messages)},y=l!=null&&l.profile_photo?F+l.profile_photo:P,r=c.useRef(null),g=()=>{r.current.scrollTop=r.current.scrollHeight},m=async t=>{if(t.preventDefault(),f=="")return;let s={text:f};i.id&&(s.message_id=i.id),await j.post(`/api/v1/chat/${d}`,s).then(o=>{console.log(o);const N=o.data.data;n(D=>[...D,N]),p(""),u({})}).catch(o=>{console.log(o)})},x=t=>{t.keyCode==13&&t.shiftKey==!1&&(t.preventDefault(),m(t))},T=(t,s)=>{t.detail==2&&(console.log("double click",s),u(s))},_=()=>{u({})};c.useEffect(()=>{v(),g(),p("");const t=new WebSocket(`ws://localhost:8080/ws/chat/${d}`);return t.onopen=s=>{console.log("connected chat user")},t.onmessage=s=>{const o=JSON.parse(s.data);window.location.pathname.includes(`/chat/${o.id}`)&&n(N=>[...N,o.message])},()=>{console.log("cleanup chat user"),t.close()}},[d]),c.useEffect(()=>{g()},[h]);const[$,k]=c.useState(null),[C,M]=c.useState(null),B=t=>{const s=t.target.files[0];s&&(k(s),M(URL.createObjectURL(s)))},z=()=>{k(null),M(null)};return a(R,{children:[a("div",{className:"w-full px-4 py-5 border-b sm:px-6 flex flex-row",children:[e("div",{className:"flex flex-col items-center justify-center w-10 h-10 mr-4",children:e("a",{href:"#",className:"relative block",children:e("img",{alt:"profil",src:y,className:"mx-auto object-cover rounded-full h-10 w-10 "})})}),a("div",{className:"flex-1 pl-1 md:mr-16",children:[e("div",{className:"font-medium dark:text-white",children:(l==null?void 0:l.first_name)+" "+(l==null?void 0:l.last_name)}),e("div",{className:"text-sm text-gray-600 dark:text-gray-200",children:l==null?void 0:l.username})]})]}),e("div",{className:"chat h-full px-4 pb-3 overflow-y-auto",ref:r,children:e("div",{className:"flex flex-col justify-start items-center w-full",children:h==null?void 0:h.map((t,s)=>{let o=null;return t.message_id&&(o=h.find(w=>w.id==t.message_id)),e(W,{message:t,replyTo:o,onClickBubble:w=>T(w,t)},s)})})}),a("div",{className:"w-full bg-gray-100 px-4 py-5",children:[!!i.id&&a("div",{className:"text-gray-500 flex items-center justify-between mb-5",children:[e("div",{className:"flex items-center",children:a("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-corner-up-left",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e("path",{d:"M18 18v-6a3 3 0 0 0 -3 -3h-10l4 -4m0 8l-4 -4"})]})}),a("div",{className:"w-full px-4 text-left flex",children:[!!i.file&&i.file.type=="photo"&&e("div",{className:"mr-3",children:e("img",{src:L+"files/photo/"+i.file.file_name,alt:"",className:"w-10",loading:"lazy"})}),e("div",{children:i.text})]}),e("div",{className:"flex items-center",children:e("button",{onClick:_,children:a("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-x",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e("path",{d:"M18 6l-12 12"}),e("path",{d:"M6 6l12 12"})]})})})]}),!!C&&a("div",{className:"text-gray-500 flex items-center justify-between mb-3",children:[e("div",{className:"w-full",children:e("img",{src:C,alt:"",className:"w-1/3",loading:"lazy"})}),e("div",{className:"flex items-center",children:e("button",{onClick:z,children:a("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-x",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e("path",{d:"M18 6l-12 12"}),e("path",{d:"M6 6l12 12"})]})})})]}),a("form",{className:"bg-white shadow flex",onSubmit:m,children:[a("div",{className:"flex-1 flex items-center",children:[e("div",{className:"pl-4 text-gray-500 cursor-pointer",children:a("div",{className:"relative inline-block w-full text-center cursor-pointer",children:[e("label",{htmlFor:"file",className:"text-gray-500 cursor-pointer",children:a("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-paperclip inline-block",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e("path",{d:"M15 7l-6.5 6.5a1.5 1.5 0 0 0 3 3l6.5 -6.5a3 3 0 0 0 -6 -6l-6.5 6.5a4.5 4.5 0 0 0 9 9l6.5 -6.5"})]})}),e("input",{id:"file",onChange:B,name:"file",type:"file",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"})]})}),e("textarea",{name:"",rows:"1",className:"w-full block outline-none py-3 px-4 bg-transparent border-none  focus:ring-0 resize-none",placeholder:"Type a message...",value:f,onChange:t=>p(t.target.value),onKeyDown:x})]}),e("div",{className:"flex-2 flex justify-center",children:e("button",{type:"submit",className:"w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 focus:ring-0 focus:ring-offset-blue-200 text-white transition ease-in duration-200 text-center shadow focus:outline-none",children:"Send"})})]})]})]})}export{U as default};
