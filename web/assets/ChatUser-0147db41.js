import{a as c,j as l,u as C,r as d,F as D,b as v}from"./index-ffc8b169.js";import{u as M}from"./user-ca0d8e03.js";let N;N="/storage/";function _(r){const e=r.message,f=e.user_id?"items-start":"items-end",n=f=="items-start"?"bg-purple-100":"bg-purple-300",a=e.date?new Date(e.date*1e3):new Date;let u=a.getDate()<10?"0"+a.getDate():a.getDate(),m=a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1,y=a.getFullYear(),h=u+"/"+m+"/"+y,p=a.getHours()<10?"0"+a.getHours():a.getHours(),g=a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes();h+=" "+p+":"+g;const o=r.replyTo,x=t=>{const s=t.file;if(s&&s.type=="photo")return l("img",{src:N+"files/photo/"+s.file_name,loading:"lazy",className:"w-full h-full"})};return c("div",{className:"w-full py-2 flex flex-col justify-start "+f,children:[c("div",{className:n+" shadow-md min-w-min max-w-lg whitespace-pre-wrap",children:[!!o&&c("div",{className:"bg-purple-200 shadow-md text-gray-600 border-l-2 border-purple-400"+(o.file?" mx-2 mt-2":" mx-1 mt-1"),children:[x(o),!!o.text&&l("div",{className:"px-2 py-1",children:o.text})]}),x(e),!!e.text&&l("div",{className:"px-2 py-1 mx-1 text-gray-800",children:e.text})]}),l("span",{className:"text-xs py-1 text-gray-400",children:h})]})}let j;j="/storage/profiles/";function T(){const{chatId:r}=C(),[e,f]=d.useState({}),[n,a]=d.useState([]),[u,m]=d.useState(""),y=async()=>{const s=(await v.get(`/api/v1/chat/${r}`)).data.data;f(s),a(s==null?void 0:s.messages)},h=e!=null&&e.profile_photo?j+e.profile_photo:M,p=d.useRef(null),g=()=>{p.current.scrollTop=p.current.scrollHeight},o=async t=>{t.preventDefault(),u!=""&&await v.post(`/api/v1/chat/${r}`,{text:u}).then(s=>{console.log(s);const w=s.data.data;a(b=>[...b,w]),m("")}).catch(s=>{console.log(s)})},x=t=>{t.keyCode==13&&t.shiftKey==!1&&(t.preventDefault(),o(t))};return d.useEffect(()=>{y(),g(),m("");const t=new WebSocket(`ws://localhost:8080/ws/chat/${r}`);return t.onopen=s=>{console.log("connected chat user")},t.onmessage=s=>{const i=JSON.parse(s.data);window.location.pathname.includes(`/chat/${i.id}`)&&a(b=>[...b,i.message])},()=>{console.log("cleanup chat user"),t.close()}},[r]),d.useEffect(()=>{g()},[n]),c(D,{children:[c("div",{className:"w-full px-4 py-5 border-b sm:px-6 flex flex-row",children:[l("div",{className:"flex flex-col items-center justify-center w-10 h-10 mr-4",children:l("a",{href:"#",className:"relative block",children:l("img",{alt:"profil",src:h,className:"mx-auto object-cover rounded-full h-10 w-10 "})})}),c("div",{className:"flex-1 pl-1 md:mr-16",children:[l("div",{className:"font-medium dark:text-white",children:(e==null?void 0:e.first_name)+" "+(e==null?void 0:e.last_name)}),l("div",{className:"text-sm text-gray-600 dark:text-gray-200",children:e==null?void 0:e.username})]})]}),l("div",{className:"chat h-full px-4 pb-3 overflow-y-auto",ref:p,children:l("div",{className:"flex flex-col justify-start items-center w-full",children:n==null?void 0:n.map((t,s)=>{let i=null;return t.message_id&&(i=n.find(w=>w.id==t.message_id)),l(_,{message:t,replyTo:i},s)})})}),l("div",{className:"w-full bg-gray-100 px-4 py-5",children:c("form",{className:"bg-white shadow rounded flex",onSubmit:o,children:[l("div",{className:"flex-1",children:l("textarea",{name:"",rows:"1",className:"w-full block outline-none py-3 px-4 bg-transparent focus:border-purple-500 resize-none",placeholder:"Type a message...",value:u,onChange:t=>m(t.target.value),onKeyDown:x})}),l("div",{className:"flex-2 flex justify-center",children:l("button",{type:"submit",className:"w-full py-3 px-4 bg-purple-600 hover:bg-purple-700 focus:ring-0 focus:ring-offset-purple-200 text-white transition ease-in duration-200 text-center shadow focus:outline-none",children:"Send"})})]})})]})}export{T as default};
